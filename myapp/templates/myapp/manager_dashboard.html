{% extends 'myapp/base.html' %}
{% load static %}
{% block title %}ACME Manufacturing Corp. - Manager Dashboard{% endblock %}

{% block extra_css %} <!-- Add extra CSS specific to the manager dashboard -->
<link rel="stylesheet" href="{% static 'myapp/manager_dashboard.css' %}">
{% endblock %}

{% block content %} <!-- This is the start of the content block -->

<!-- Inline CSS -->
<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 2rem;
    border-radius: 12px;
    width: 60%;
    position: relative;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .close-btn {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
  }
</style>


<body>
<!-- Navbar -->
  <nav class="navbar">
    <h1>ACME Manufacturing Manager Panel</h1>
  </nav>

  <main class="container">
    <h2>Welcome, Manager!</h2>

    <!-- Status Summary Cards -->
    <div class="status-cards">
      <div class="card green">
        <h3>Active Machines</h3>
        <p>24</p>
      </div>
      <div class="card yellow">
        <h3>Machines Needing Attention</h3>
        <p>5</p>
      </div>
      <div class="card red">
        <h3>Faulty Machines</h3>
        <p>2</p>
      </div>
    </div>

    <!-- Collection Filter -->
    <section class="table-section">
      <h3>Filter by Machine Collection</h3>
      <select>
        <option>All Collections</option>
        <option>MainCampus</option>
        <option>Building-A</option>
        <option>Soldering-Machines</option>
      </select>
    </section>

    <!-- Add/Delete Machines -->
    <section class="table-section">
      <h3>Manage Machinery</h3>
      <form class="add-machine-form">
        <input type="text" placeholder="Machine Name" required />
        <input type="text" placeholder="Location/Collection" required />
        <button type="submit">Add Machine</button>
      </form>

      <!-- Machine table -->
      <table>
        <thead>
          <tr>
            <th>Machine</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Machine A1</td>
            <td>OK</td>
            <td><button class="delete-btn">Delete</button></td>
          </tr>
          <tr>
            <td>Machine B3</td>
            <td>Fault</td>
            <td><button class="delete-btn">Delete</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Assignment Table -->
    <section class="table-section">
      <h3>Assign Technicians or Repair Personnel</h3>
      <table>
        <thead>
          <tr>
            <th>Machine</th>
            <th>Status</th>
            <th>Assigned Technician</th>
            <th>Assigned Repair</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Machine A1</td>
            <td>Warning</td>
            <td>
              <select>
                <option>-- Select Technician --</option> <!-- Dropdown for choice of technician -->
                <option>Joe</option>
                <option>Ana</option>
              </select>
            </td>
            <td>
              <select>
                <option>-- Select Repair --</option> <!-- Dropwdown for repair -->
                <option>Chris</option>
                <option>Lina</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Machine B3</td>
            <td>Fault</td>
            <td>
              <select>
                <option>-- Select Technician --</option>
                <option>Joe</option>
                <option>Ana</option>
              </select>
            </td>
            <td>
              <select>
                <option>-- Select Repair --</option>
                <option>Chris</option>
                <option>Lina</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Export Report -->
    <div style="text-align: right; margin-top: 2rem;">
      <button onclick="alert('Export functionality coming soon!')">ðŸ“„ Export Report</button>
    </div>

    <!-- Fault Cases Table -->
    <section class="table-section">
      <h3>Recent Fault Cases</h3>
      <table>
        <thead>
          <tr>
            <th>Machine</th>
            <th>Issue</th>
            <th>Reported By</th>
            <th>Status</th>
            <th>Date</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Machine A1</td>
            <td>Temperature Spike</td>
            <td>Joe</td>
            <td class="status in-progress">In Progress</td>
            <td>2025-04-07</td>
            <td><a href="#" onclick="openModal()">View</a></td> <!-- Open table to see detailed version -->
          </tr>
          <tr>
            <td>Machine B3</td>
            <td>Hydraulic Leak</td>
            <td>Sara</td>
            <td class="status unresolved">Unresolved</td>
            <td>2025-04-06</td>
            <td><a href="#" onclick="openModal()">View</a></td> <!-- Open table to see detailed version -->
          </tr>
        </tbody>
      </table>
    </section>

    <!-- API Test Form -->
    <section class="table-section">
      <h3>Test External API Submission</h3>
      <form onsubmit="postWarning(event)"> <!-- Form that simulates an API call when submitted -->
        <label>Machine ID: <input type="text" id="machine-id" required></label> <!-- Input for the Machine ID the warning is related to -->
        <label>Warning: <input type="text" id="warning-text" required></label> <!-- Input for the warning message/details -->
        <button type="submit">Send Warning</button>
      </form>
    </section>

    <!-- Create Users Form -->
    <section class="table-section">
      <h3>Create Users</h3>
      <form method="post"> <!-- Submit data to server -->
        {% csrf_token %}
        {{ form }} <!-- render form for creating users -->
        <button type="submit">Add New User</button>

      </form>
    </section>

  </main>

  <!-- Modal: Manager View -->
  <div id="caseModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h3>Case #1035 - Fault Details</h3>
      <p><strong>Machine:</strong> C3</p>
      <p><strong>Status:</strong> In Progress</p>
      <p><strong>Reported By:</strong> Technician Joe</p>
      <h4>Timeline:</h4>
      <ul>
        <li>[2025-04-05] Joe: Belt worn.</li>
        <li>[2025-04-06] Lina: Replacement ordered.</li>
      </ul>
      <p style="font-style: italic;">Managers can view only. Use admin panel for actions.</p>
    </div>
  </div>


  <script>
    function postWarning(e) { // Function to simulate a POST request when the form is submitted
      e.preventDefault(); // Prevent the default form submission behavior
      const id = document.getElementById("machine-id").value; // Get the machine ID from the input field
      const warning = document.getElementById("warning-text").value; // Get the warning text from the input field
      alert(`Simulated POST: Machine ${id} - Warning: "${warning}"`); // Show an alert with the machine ID and warning text
    }

    function openModal() { // Function to open the modal when the "View" link is clicked
      document.getElementById("caseModal").style.display = "block"; // Make modal visible
    }

    function closeModal() { // Function to close the modal when the close button is clicked
      document.getElementById("caseModal").style.display = "none"; // Hide modal
    }

    window.onclick = function (event) { // Function to close the modal when clicking outside of it
      const modal = document.getElementById("caseModal"); 
      if (event.target === modal) { // Check if the clicked element is the modal itself
        closeModal();
      }
    }
  </script>
</body>
{% endblock %}